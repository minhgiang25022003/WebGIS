<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="utf-8">
    <title>WebGIS - Sinh vật biển Cà Mau</title>
    <link rel="stylesheet" href="https://openlayers.org/en/v4.6.5/css/ol.css" type="text/css" />
    <script src="https://openlayers.org/en/v4.6.5/build/ol.js"></script>
    <style>
    /* Đặt style cho toàn bộ trang */
    body {
        margin: 0;
        padding: 0;
        display: flex;
        flex-direction: column;
        height: 100vh;
        overflow: hidden;
        background-color: #2b2b2b;
    }

    /* Header */
    header {
        background-color: #222;
        color: #00FF00;
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 10px 20px;
    }
    header a {
        text-decoration: none;
        color: white;
        margin-left: 15px;
    }
    header a.active {
        background-color: #00FF00;
        color: black;
        padding: 5px 10px;
        border-radius: 5px;
    }

    /* Phần chính chứa bản đồ và sidebar */
    #content {
        display: flex;
        flex: 1;
    }
    #sidebar {
        width: 20%;
        padding: 10px;
        border-right: 1px solid #ccc;
        height: calc(100vh - 120px);
        overflow-y: auto;
        background-color: #333;
        color: white;
    }
    #map {
        flex-grow: 1;
        height: calc(100vh - 100px);
        margin-left: 10px; /* Thêm khoảng cách bên trái để không đè lên thanh bên */
    }

    /* Popup trên bản đồ */
    .ol-popup {
        position: absolute;
        background-color: white;
        padding: 10px;
        border-radius: 8px;
        border: 1px solid #ccc;
        bottom: 12px;
        min-width: 200px;
        box-shadow: 0 1px 4px rgba(0, 0, 0, 0.2);
    }

    /* Footer */
    footer {
        background-color: #222;
        color: white;
        text-align: center;
        padding: 10px 0;
        font-size: 14px;
    }
    footer a {
        color: #00FF00;
        text-decoration: none;
    }
	category {
            cursor: pointer;
            font-weight: bold;
            margin-bottom: 10px;
        }
        subcategory, .items {
            display: none;
            margin-left: 20px;
        }
        subcategory {
            cursor: pointer;
            margin-bottom: 5px;
        }
        item {
            margin-left: 40px;
        }
		/* Biểu tượng mở rộng/thu gọn */
        .toggle-icon {
            margin-right: 10px;
        }

        .expanded::before {
            content: "+"; /* Dấu trừ cho mở rộng */
        }

        .collapsed::before {
            content: "-"; /* Dấu cộng cho thu gọn */
        }
		.item {
            margin-left: 20px;
        }
</style>


</head>

<body onload="initialize_map();">

<!-- Phần đầu trang -->
<header>
    <div>Sinh vật biển Cà Mau</div>
    <nav>
        <a href="web3.html">Trang chủ</a>
        <a href="#" class="active">WebGIS</a>
    </nav>
</header>

<!-- Phần nội dung chứa sidebar và bản đồ -->
<div id="content">
    <!-- Sidebar bên trái -->
    <div id="sidebar">
        <h3>Loại đối tượng</h3>
        <!-- Bộ 1 -->
    <div class="category collapsed" onclick="toggleDisplay('bo1', this)">Bộ Cá nhám</div>
    <div id="bo1" class="items">
        <!-- Họ 1 -->
        <div class="subcategory collapsed" onclick="toggleDisplay('ho1', this)">Họ Cá nhám chấm</div>
        <div id="ho1" class="items">
            <label class="item"><input type="checkbox"> Cá nhám chấm 1</label><br>
            <label class="item"><input type="checkbox"> Cá nhám chấm 2</label><br>
        </div>
        <!-- Họ 2 -->
        <div class="subcategory collapsed" onclick="toggleDisplay('ho2', this)">Họ Cá nhám búa</div>
        <div id="ho2" class="items">
            <label class="item"><input type="checkbox"> Cá nhám búa 1</label><br>
            <label class="item"><input type="checkbox"> Cá nhám búa 2</label><br>
        </div>
    </div>

    <!-- Bộ 2 -->
    <div class="category collapsed" onclick="toggleDisplay('bo2', this)">Bộ Rừng ngập mặn</div>
    <div id="bo2" class="items">
        <!-- Họ 1 -->
        <div class="subcategory collapsed" onclick="toggleDisplay('ho3', this)">Họ Đước</div>
        <div id="ho3" class="items">
            <label class="item"><input type="checkbox"> Đước 1</label><br>
            <label class="item"><input type="checkbox"> Đước 2</label><br>
        </div>
        <!-- Họ 2 -->
        <div class="subcategory collapsed" onclick="toggleDisplay('ho4', this)">Họ Bần</div>
        <div id="ho4" class="items">
            <label class="item"><input type="checkbox"> Bần 1</label><br>
            <label class="item"><input type="checkbox"> Bần 2</label><br>
        </div>
    </div>
    </div>
	<!-- JavaScript -->
    <script>
        function toggleDisplay(id, element) {
            const content = document.getElementById(id);
            if (content) {
                // Toggle hiển thị
                content.style.display = (content.style.display === "none" || content.style.display === "") ? "block" : "none";
                
                // Thay đổi biểu tượng
                if (element.classList.contains('collapsed')) {
                    element.classList.remove('collapsed');
                    element.classList.add('expanded');
                } else {
                    element.classList.remove('expanded');
                    element.classList.add('collapsed');
                }
            }
        }
    </script>


    <!-- Khu vực bản đồ nằm bên phải -->
    <div id="map"></div>
	<!-- Popup -->
    <div id="popup" class="ol-popup"></div>
</div>

<!-- Phần chân trang -->
<footer>
    © Sinh vật biển Cà Mau 2024 <br>
    Bản quyền hình ảnh thuộc về các nhiếp ảnh gia được ghi nhận. Mọi yêu cầu sử dụng có thể liên hệ thông qua <a href="contact.html">form liên hệ của chúng tôi</a>.
</footer>

<script>
    var format = 'image/png';
    var map, vectorSource, overlay;
    var markers = {
        mangrove: [],
        fish: [],
        salt: []
    };

    // Cập nhật dữ liệu để bao gồm hình ảnh
    const data = [
        { 
            name: "Rừng ngập mặn 1", 
            lat: 9.02722, 
            lng: 105.32306, 
            type: "mangrove", 
            info: "Mô tả rừng ngập mặn 1", 
            img: "#"
        },
        { 
            name: "Rừng ngập mặn 2", 
            lat: 9.1698, 
            lng: 105.0921, 
            type: "mangrove", 
            info: "Mô tả rừng ngập mặn 2", 
            img: "https://example.com/mangrove2.jpg"
        },
        { 
            name: "Cá nhám chấm ", 
            lat: 8.59591, 
            lng: 104.64378, 
            type: "fish", 
            info: "Mô tả cá nhám chấm", 
            img: "img/canhamcham.jpg"
        },
        { 
            name: "Đồng muối D", 
            lat: 9.04722, 
            lng: 105.38972, 
            type: "salt", 
            info: "Mô tả đồng muối D", 
            img: "https://example.com/salt1.jpg"
        }
    ];

    function initialize_map() {
        var layerBG = new ol.layer.Tile({ source: new ol.source.OSM() });

        // Lớp WMS từ GeoServer
        var layerhuyen = new ol.layer.Image({
            source: new ol.source.ImageWMS({
                ratio: 1,
                url: 'http://localhost:8080/geoserver/Web1/wms?service=WMS&version=1.1.0&request=GetMap&layers=Web1%3Ahuyen&bbox=104.69068908691406%2C8.412519454956055%2C105.41751861572266%2C9.562411308288574&width=485&height=768&srs=EPSG%3A4326&styles=&format=application/openlayers',
                params: {
                    'FORMAT': 'image/png',
                    'VERSION': '1.1.0',
                    STYLES: '',
                    LAYERS: 'Web1:huyen'
                }
            })
        });

        vectorSource = new ol.source.Vector();

        data.forEach(item => {
            var marker = createMarker(item.lat, item.lng, item.name, item.info, item.img);
            vectorSource.addFeature(marker);
            markers[item.type].push(marker);
        });

        var vectorLayer = new ol.layer.Vector({ source: vectorSource });

        var viewMap = new ol.View({
            center: ol.proj.fromLonLat([105.1524, 9.1883]),
            zoom: 9
        });

        map = new ol.Map({
            target: 'map',
            layers: [layerBG, layerhuyen, vectorLayer],
            view: viewMap
        });

        // Tạo overlay cho popup
        overlay = new ol.Overlay({
            element: document.getElementById('popup'),
            autoPan: true,
            autoPanAnimation: { duration: 250 }
        });
        map.addOverlay(overlay);

        map.on('click', function (evt) {
            var feature = map.forEachFeatureAtPixel(evt.pixel, function (feature) {
                return feature;
            });

            if (feature) {
                var coordinates = feature.getGeometry().getCoordinates();
                var name = feature.get('name');
                var info = feature.get('info');
                var img = feature.get('img');
                showPopup(coordinates, name, info, img);
            } else {
                overlay.setPosition(undefined);
            }
        });
    }

    function createMarker(lat, lng, name, info, img) {
        var feature = new ol.Feature({
            geometry: new ol.geom.Point(ol.proj.fromLonLat([lng, lat])),
            name: name,
            info: info,
            img: img
        });

        var style = new ol.style.Style({
            image: new ol.style.Circle({
                radius: 6,
                fill: new ol.style.Fill({ color: 'blue' }),
                stroke: new ol.style.Stroke({ color: 'white', width: 2 })
            })
        });

        feature.setStyle(style);
        return feature;
    }

    // Hàm hiển thị popup với hình ảnh
    function showPopup(coordinates, name, info, img) {
        var popupElement = document.getElementById('popup');
        popupElement.innerHTML = `
            <b>${name}</b><br>${info}<br>
            <img src="${img}" alt="${name}" style="width:150px; height:auto; margin-top:10px;">
        `;
        overlay.setPosition(coordinates);
    }

    function updateMarkers() {
        Object.keys(markers).forEach(type => {
            const isChecked = document.getElementById(type).checked;
            markers[type].forEach(marker => {
                marker.setStyle(isChecked ? getMarkerStyle(type) : null);
            });
        });
    }

    function getMarkerStyle(type) {
        const colors = {
            mangrove: 'green',
            fish: 'red',
            salt: 'orange'
        };

        return new ol.style.Style({
            image: new ol.style.Circle({
                radius: 6,
                fill: new ol.style.Fill({ color: colors[type] }),
                stroke: new ol.style.Stroke({ color: 'white', width: 2 })
            })
        });
    }
</script>
</body>
</html>